(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{506:function(n,s,t){"use strict";t.r(s);var a=t(33),e=Object(a.a)({},(function(){var n=this,s=n.$createElement,t=n._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[t("h1",{attrs:{id:"java-nio"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#java-nio"}},[n._v("#")]),n._v(" Java NIO")]),n._v(" "),t("h2",{attrs:{id:"一、简介"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#一、简介"}},[n._v("#")]),n._v(" 一、简介")]),n._v(" "),t("p",[n._v("Java NIO（New IO）是从Java 1.4版本开始引入的一个新的IO API，"),t("strong",[n._v("可以替代标准的Java IO API")]),n._v("。NIO与原来的IO有同样的作用和目的，但是使用的方式完全不同，NIO支持"),t("strong",[n._v("面向缓冲区的、基于通道的IO操作")]),n._v("。NIO将以更加高效的方式进行文件的读写操作。")]),n._v(" "),t("h2",{attrs:{id:"二、io与nio的区别"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#二、io与nio的区别"}},[n._v("#")]),n._v(" 二、IO与NIO的区别")]),n._v(" "),t("table",[t("thead",[t("tr",[t("th",[n._v("IO")]),n._v(" "),t("th",[n._v("NIO")])])]),n._v(" "),t("tbody",[t("tr",[t("td",[n._v("面向流(Stream Oriented)")]),n._v(" "),t("td",[n._v("面向缓冲区(Buffer Oriented)")])]),n._v(" "),t("tr",[t("td",[n._v("阻塞IO(Blocking IO)")]),n._v(" "),t("td",[n._v("非阻塞IO(NonBlocking IO)")])]),n._v(" "),t("tr",[t("td"),n._v(" "),t("td",[n._v("选择器(Selectors)")])])])]),n._v(" "),t("h3",{attrs:{id:"_1、面向流和缓冲区"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、面向流和缓冲区"}},[n._v("#")]),n._v(" 1、面向流和缓冲区")]),n._v(" "),t("p",[t("strong",[n._v("IO")])]),n._v(" "),t("p",[n._v("传统IO在传输数据时，根据输入输出的不同需要分别建立不同的链接，而且传输的数据是以流的形式在链接上进行传输的")]),n._v(" "),t("p",[n._v("就像自来水要通过水管将自来水厂和家连接起来一样")]),n._v(" "),t("p",[t("a",{attrs:{href:"https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201109084453.png",target:"_blank",rel:"noopener noreferrer"}},[t("img",{attrs:{src:"https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201109084453.png",alt:"img"}}),t("OutboundLink")],1)]),n._v(" "),t("p",[t("strong",[n._v("NIO")])]),n._v(" "),t("p",[n._v("NIO在传输数据时，会在输入输出端之间建立"),t("strong",[n._v("通道")]),n._v("，然后将数据放入到"),t("strong",[n._v("缓冲区")]),n._v("中。缓冲区通过通道来传输数据")]),n._v(" "),t("p",[n._v("这里通道就像是铁路，能够连通两个地点。缓冲区就像是火车，能够真正地进行数据的传输")]),n._v(" "),t("p",[t("a",{attrs:{href:"https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201109085054.png",target:"_blank",rel:"noopener noreferrer"}},[t("img",{attrs:{src:"https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201109085054.png",alt:"img"}}),t("OutboundLink")],1)]),n._v(" "),t("h2",{attrs:{id:"三、通道与缓冲区"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#三、通道与缓冲区"}},[n._v("#")]),n._v(" 三、通道与缓冲区")]),n._v(" "),t("p",[n._v("Java NIO系统的核心在于："),t("strong",[n._v("通道(Channel)和缓冲区(Buffer)")]),n._v("。通道表示打开到 IO 设备(例如：文件、套接字)的连接。若需要使用 NIO 系统，需要获取用于连接 IO 设备的通道以及用于容纳数据的缓冲区。然后操作缓冲区，对数据进行处理")]),n._v(" "),t("p",[n._v("简而言之，"),t("strong",[n._v("通道负责传输，缓冲区负责存储")])]),n._v(" "),t("h2",{attrs:{id:"四、缓冲区-buffer"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#四、缓冲区-buffer"}},[n._v("#")]),n._v(" 四、缓冲区(Buffer)")]),n._v(" "),t("h3",{attrs:{id:"_1、缓冲区类型"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、缓冲区类型"}},[n._v("#")]),n._v(" 1、缓冲区类型")]),n._v(" "),t("p",[n._v("Buffer 就像一个数组，可以保存多个相同类型的数据。根据数据类型不同("),t("strong",[n._v("boolean 除外")]),n._v(") ，有以下Buffer 常用子类")]),n._v(" "),t("ul",[t("li",[n._v("ByteBuffer")]),n._v(" "),t("li",[n._v("CharBuffer")]),n._v(" "),t("li",[n._v("ShortBuffer")]),n._v(" "),t("li",[n._v("IntBuffer")]),n._v(" "),t("li",[n._v("LongBuffer")]),n._v(" "),t("li",[n._v("FloatBuffer")]),n._v(" "),t("li",[n._v("DoubleBuffer")])]),n._v(" "),t("p",[t("strong",[n._v("各种类型的缓冲区中，都有一个对应类型的数组")]),n._v("，如")]),n._v(" "),t("p",[n._v("ByteBuffer")]),n._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v("final byte[] hb;                  // Non-null only for heap buffersCopy\n")])]),n._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[n._v("1")]),t("br")])]),t("p",[n._v("IntBuffer")]),n._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v("final int[] hb;                  // Non-null only for heap buffersCopy\n")])]),n._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[n._v("1")]),t("br")])]),t("p",[t("strong",[n._v("他们的继承关系如下")])]),n._v(" "),t("p",[t("a",{attrs:{href:"https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201109091555.png",target:"_blank",rel:"noopener noreferrer"}},[t("img",{attrs:{src:"https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201109091555.png",alt:"img"}}),t("OutboundLink")],1)]),n._v(" "),t("h3",{attrs:{id:"_2、获取缓冲区"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2、获取缓冲区"}},[n._v("#")]),n._v(" 2、获取缓冲区")]),n._v(" "),t("p",[n._v("通过"),t("strong",[n._v("allocate方法")]),n._v("可以获取一个对应缓冲区的对象，它是缓冲区类的一个静态方法")]),n._v(" "),t("p",[n._v("例")]),n._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v("// 获取一个容量大小为1024字节的字节缓冲区\nByteBuffer byteBuffer = ByteBuffer.allocate(1024);Copy\n")])]),n._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[n._v("1")]),t("br"),t("span",{staticClass:"line-number"},[n._v("2")]),t("br")])]),t("h3",{attrs:{id:"_3、核心属性"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3、核心属性"}},[n._v("#")]),n._v(" 3、核心属性")]),n._v(" "),t("p",[n._v("缓冲区的父类Buffer中有几个核心属性，如下")]),n._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v("// Invariants: mark <= position <= limit <= capacity\nprivate int mark = -1;\nprivate int position = 0;\nprivate int limit;\nprivate int capacity;Copy\n")])]),n._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[n._v("1")]),t("br"),t("span",{staticClass:"line-number"},[n._v("2")]),t("br"),t("span",{staticClass:"line-number"},[n._v("3")]),t("br"),t("span",{staticClass:"line-number"},[n._v("4")]),t("br"),t("span",{staticClass:"line-number"},[n._v("5")]),t("br")])]),t("ul",[t("li",[n._v("capacity：缓冲区的容量。通过构造函数赋予，一旦设置，无法更改")]),n._v(" "),t("li",[n._v("limit：缓冲区的界限。位于limit 后的数据不可读写。缓冲区的限制不能为负，并且"),t("strong",[n._v("不能大于其容量")])]),n._v(" "),t("li",[n._v("position："),t("strong",[n._v("下一个")]),n._v("读写位置的索引（类似PC）。缓冲区的位置不能为负，并且"),t("strong",[n._v("不能大于limit")])]),n._v(" "),t("li",[n._v("mark：记录当前position的值。"),t("strong",[n._v("position被改变后，可以通过调用reset() 方法恢复到mark的位置。")])])]),n._v(" "),t("p",[n._v("以上四个属性必须满足以下要求")]),n._v(" "),t("p",[t("strong",[n._v("mark <= position <= limit <= capacity")])]),n._v(" "),t("h3",{attrs:{id:"_4、核心方法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4、核心方法"}},[n._v("#")]),n._v(" 4、核心方法")]),n._v(" "),t("h4",{attrs:{id:"put-方法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#put-方法"}},[n._v("#")]),n._v(" put()方法")]),n._v(" "),t("ul",[t("li",[n._v("put()方法可以将一个数据放入到缓冲区中。")]),n._v(" "),t("li",[n._v("进行该操作后，postition的值会+1，指向下一个可以放入的位置。capacity = limit ，为缓冲区容量的值。")])]),n._v(" "),t("p",[t("a",{attrs:{href:"https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201109145709.png",target:"_blank",rel:"noopener noreferrer"}},[t("img",{attrs:{src:"https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201109145709.png",alt:"img"}}),t("OutboundLink")],1)]),n._v(" "),t("h4",{attrs:{id:"flip-方法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#flip-方法"}},[n._v("#")]),n._v(" flip()方法")]),n._v(" "),t("ul",[t("li",[n._v("flip()方法会"),t("strong",[n._v("切换对缓冲区的操作模式")]),n._v("，由写->读 / 读->写")]),n._v(" "),t("li",[n._v("进行该操作后\n"),t("ul",[t("li",[n._v("如果是写模式->读模式，position = 0 ， limit 指向最后一个元素的下一个位置，capacity不变")]),n._v(" "),t("li",[n._v("如果是读->写，则恢复为put()方法中的值")])])])]),n._v(" "),t("p",[t("a",{attrs:{href:"https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201109145753.png",target:"_blank",rel:"noopener noreferrer"}},[t("img",{attrs:{src:"https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201109145753.png",alt:"img"}}),t("OutboundLink")],1)]),n._v(" "),t("h4",{attrs:{id:"get-方法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#get-方法"}},[n._v("#")]),n._v(" get()方法")]),n._v(" "),t("ul",[t("li",[n._v("get()方法会读取缓冲区中的一个值")]),n._v(" "),t("li",[n._v("进行该操作后，position会+1，如果超过了limit则会抛出异常")])]),n._v(" "),t("p",[t("a",{attrs:{href:"https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201109145822.png",target:"_blank",rel:"noopener noreferrer"}},[t("img",{attrs:{src:"https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201109145822.png",alt:"img"}}),t("OutboundLink")],1)]),n._v(" "),t("h4",{attrs:{id:"rewind-方法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#rewind-方法"}},[n._v("#")]),n._v(" rewind()方法")]),n._v(" "),t("ul",[t("li",[n._v("该方法"),t("strong",[n._v("只能在读模式下使用")])]),n._v(" "),t("li",[n._v("rewind()方法后，会恢复position、limit和capacity的值，变为进行get()前的值")])]),n._v(" "),t("p",[t("a",{attrs:{href:"https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201109145852.png",target:"_blank",rel:"noopener noreferrer"}},[t("img",{attrs:{src:"https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201109145852.png",alt:"img"}}),t("OutboundLink")],1)]),n._v(" "),t("h4",{attrs:{id:"clean-方法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#clean-方法"}},[n._v("#")]),n._v(" clean()方法")]),n._v(" "),t("ul",[t("li",[n._v("clean()方法会将缓冲区中的各个属性恢复为最初的状态，position = 0, capacity = limit")]),n._v(" "),t("li",[t("strong",[n._v("此时缓冲区的数据依然存在")]),n._v("，处于“被遗忘”状态，下次进行写操作时会覆盖这些数据")])]),n._v(" "),t("p",[t("a",{attrs:{href:"https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201109145905.png",target:"_blank",rel:"noopener noreferrer"}},[t("img",{attrs:{src:"https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201109145905.png",alt:"img"}}),t("OutboundLink")],1)]),n._v(" "),t("h4",{attrs:{id:"mark-和reset-方法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mark-和reset-方法"}},[n._v("#")]),n._v(" mark()和reset()方法")]),n._v(" "),t("ul",[t("li",[n._v("mark()方法会将postion的值保存到mark属性中")]),n._v(" "),t("li",[n._v("reset()方法会将position的值改为mark中保存的值")])]),n._v(" "),t("h4",{attrs:{id:"使用展示"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用展示"}},[n._v("#")]),n._v(" 使用展示")]),n._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v('public class Demo1 {\n\tpublic static void main(String[] args) {\n\t\tByteBuffer byteBuffer = ByteBuffer.allocate(1024);\n\n\t\tSystem.out.println("放入前参数");\n\t\tSystem.out.println("position " + byteBuffer.position());\n\t\tSystem.out.println("limit " + byteBuffer.limit());\n\t\tSystem.out.println("capacity " + byteBuffer.capacity());\n\t\tSystem.out.println();\n\n\t\tSystem.out.println("------put()------");\n\t\tSystem.out.println("放入3个数据");\n\t\tbyte bt = 1;\n\t\tbyteBuffer.put(bt);\n\t\tbyteBuffer.put(bt);\n\t\tbyteBuffer.put(bt);\n\n\t\tSystem.out.println("放入后参数");\n\t\tSystem.out.println("position " + byteBuffer.position());\n\t\tSystem.out.println("limit " + byteBuffer.limit());\n\t\tSystem.out.println("capacity " + byteBuffer.capacity());\n\t\tSystem.out.println();\n\n\t\tSystem.out.println("------flip()-get()------");\n\t\tSystem.out.println("读取一个数据");\n\t\t// 切换模式\n\t\tbyteBuffer.flip();\n\t\tbyteBuffer.get();\n\n\t\tSystem.out.println("读取后参数");\n\t\tSystem.out.println("position " + byteBuffer.position());\n\t\tSystem.out.println("limit " + byteBuffer.limit());\n\t\tSystem.out.println("capacity " + byteBuffer.capacity());\n\t\tSystem.out.println();\n\n\t\tSystem.out.println("------rewind()------");\n\t\tbyteBuffer.rewind();\n\t\tSystem.out.println("恢复后参数");\n\t\tSystem.out.println("position " + byteBuffer.position());\n\t\tSystem.out.println("limit " + byteBuffer.limit());\n\t\tSystem.out.println("capacity " + byteBuffer.capacity());\n\t\tSystem.out.println();\n\n\t\tSystem.out.println("------clear()------");\n\t\t// 清空缓冲区，这里只是恢复了各个属性的值，但是缓冲区里的数据依然存在\n\t\t// 但是下次写入的时候会覆盖缓冲区中之前的数据\n\t\tbyteBuffer.clear();\n\t\tSystem.out.println("清空后参数");\n\t\tSystem.out.println("position " + byteBuffer.position());\n\t\tSystem.out.println("limit " + byteBuffer.limit());\n\t\tSystem.out.println("capacity " + byteBuffer.capacity());\n\t\tSystem.out.println();\n\t\tSystem.out.println("清空后获得数据");\n\t\tSystem.out.println(byteBuffer.get());\n\n\t}\n}\n')])]),n._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[n._v("1")]),t("br"),t("span",{staticClass:"line-number"},[n._v("2")]),t("br"),t("span",{staticClass:"line-number"},[n._v("3")]),t("br"),t("span",{staticClass:"line-number"},[n._v("4")]),t("br"),t("span",{staticClass:"line-number"},[n._v("5")]),t("br"),t("span",{staticClass:"line-number"},[n._v("6")]),t("br"),t("span",{staticClass:"line-number"},[n._v("7")]),t("br"),t("span",{staticClass:"line-number"},[n._v("8")]),t("br"),t("span",{staticClass:"line-number"},[n._v("9")]),t("br"),t("span",{staticClass:"line-number"},[n._v("10")]),t("br"),t("span",{staticClass:"line-number"},[n._v("11")]),t("br"),t("span",{staticClass:"line-number"},[n._v("12")]),t("br"),t("span",{staticClass:"line-number"},[n._v("13")]),t("br"),t("span",{staticClass:"line-number"},[n._v("14")]),t("br"),t("span",{staticClass:"line-number"},[n._v("15")]),t("br"),t("span",{staticClass:"line-number"},[n._v("16")]),t("br"),t("span",{staticClass:"line-number"},[n._v("17")]),t("br"),t("span",{staticClass:"line-number"},[n._v("18")]),t("br"),t("span",{staticClass:"line-number"},[n._v("19")]),t("br"),t("span",{staticClass:"line-number"},[n._v("20")]),t("br"),t("span",{staticClass:"line-number"},[n._v("21")]),t("br"),t("span",{staticClass:"line-number"},[n._v("22")]),t("br"),t("span",{staticClass:"line-number"},[n._v("23")]),t("br"),t("span",{staticClass:"line-number"},[n._v("24")]),t("br"),t("span",{staticClass:"line-number"},[n._v("25")]),t("br"),t("span",{staticClass:"line-number"},[n._v("26")]),t("br"),t("span",{staticClass:"line-number"},[n._v("27")]),t("br"),t("span",{staticClass:"line-number"},[n._v("28")]),t("br"),t("span",{staticClass:"line-number"},[n._v("29")]),t("br"),t("span",{staticClass:"line-number"},[n._v("30")]),t("br"),t("span",{staticClass:"line-number"},[n._v("31")]),t("br"),t("span",{staticClass:"line-number"},[n._v("32")]),t("br"),t("span",{staticClass:"line-number"},[n._v("33")]),t("br"),t("span",{staticClass:"line-number"},[n._v("34")]),t("br"),t("span",{staticClass:"line-number"},[n._v("35")]),t("br"),t("span",{staticClass:"line-number"},[n._v("36")]),t("br"),t("span",{staticClass:"line-number"},[n._v("37")]),t("br"),t("span",{staticClass:"line-number"},[n._v("38")]),t("br"),t("span",{staticClass:"line-number"},[n._v("39")]),t("br"),t("span",{staticClass:"line-number"},[n._v("40")]),t("br"),t("span",{staticClass:"line-number"},[n._v("41")]),t("br"),t("span",{staticClass:"line-number"},[n._v("42")]),t("br"),t("span",{staticClass:"line-number"},[n._v("43")]),t("br"),t("span",{staticClass:"line-number"},[n._v("44")]),t("br"),t("span",{staticClass:"line-number"},[n._v("45")]),t("br"),t("span",{staticClass:"line-number"},[n._v("46")]),t("br"),t("span",{staticClass:"line-number"},[n._v("47")]),t("br"),t("span",{staticClass:"line-number"},[n._v("48")]),t("br"),t("span",{staticClass:"line-number"},[n._v("49")]),t("br"),t("span",{staticClass:"line-number"},[n._v("50")]),t("br"),t("span",{staticClass:"line-number"},[n._v("51")]),t("br"),t("span",{staticClass:"line-number"},[n._v("52")]),t("br"),t("span",{staticClass:"line-number"},[n._v("53")]),t("br"),t("span",{staticClass:"line-number"},[n._v("54")]),t("br"),t("span",{staticClass:"line-number"},[n._v("55")]),t("br"),t("span",{staticClass:"line-number"},[n._v("56")]),t("br"),t("span",{staticClass:"line-number"},[n._v("57")]),t("br")])]),t("p",[n._v("打印结果")]),n._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v("放入前参数\nposition 0\nlimit 1024\ncapacity 1024\n\n------put()------\n放入3个数据\n放入后参数\nposition 3\nlimit 1024\ncapacity 1024\n\n------flip()-get()------\n读取一个数据\n读取后参数\nposition 1\nlimit 3\ncapacity 1024\n\n------rewind()------\n恢复后参数\nposition 0\nlimit 3\ncapacity 1024\n\n------clear()------\n清空后参数\nposition 0\nlimit 1024\ncapacity 1024\n\n清空后获得数据\n1Copy\n")])]),n._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[n._v("1")]),t("br"),t("span",{staticClass:"line-number"},[n._v("2")]),t("br"),t("span",{staticClass:"line-number"},[n._v("3")]),t("br"),t("span",{staticClass:"line-number"},[n._v("4")]),t("br"),t("span",{staticClass:"line-number"},[n._v("5")]),t("br"),t("span",{staticClass:"line-number"},[n._v("6")]),t("br"),t("span",{staticClass:"line-number"},[n._v("7")]),t("br"),t("span",{staticClass:"line-number"},[n._v("8")]),t("br"),t("span",{staticClass:"line-number"},[n._v("9")]),t("br"),t("span",{staticClass:"line-number"},[n._v("10")]),t("br"),t("span",{staticClass:"line-number"},[n._v("11")]),t("br"),t("span",{staticClass:"line-number"},[n._v("12")]),t("br"),t("span",{staticClass:"line-number"},[n._v("13")]),t("br"),t("span",{staticClass:"line-number"},[n._v("14")]),t("br"),t("span",{staticClass:"line-number"},[n._v("15")]),t("br"),t("span",{staticClass:"line-number"},[n._v("16")]),t("br"),t("span",{staticClass:"line-number"},[n._v("17")]),t("br"),t("span",{staticClass:"line-number"},[n._v("18")]),t("br"),t("span",{staticClass:"line-number"},[n._v("19")]),t("br"),t("span",{staticClass:"line-number"},[n._v("20")]),t("br"),t("span",{staticClass:"line-number"},[n._v("21")]),t("br"),t("span",{staticClass:"line-number"},[n._v("22")]),t("br"),t("span",{staticClass:"line-number"},[n._v("23")]),t("br"),t("span",{staticClass:"line-number"},[n._v("24")]),t("br"),t("span",{staticClass:"line-number"},[n._v("25")]),t("br"),t("span",{staticClass:"line-number"},[n._v("26")]),t("br"),t("span",{staticClass:"line-number"},[n._v("27")]),t("br"),t("span",{staticClass:"line-number"},[n._v("28")]),t("br"),t("span",{staticClass:"line-number"},[n._v("29")]),t("br"),t("span",{staticClass:"line-number"},[n._v("30")]),t("br"),t("span",{staticClass:"line-number"},[n._v("31")]),t("br"),t("span",{staticClass:"line-number"},[n._v("32")]),t("br"),t("span",{staticClass:"line-number"},[n._v("33")]),t("br")])]),t("h3",{attrs:{id:"_5、非直接缓冲区和直接缓冲区"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5、非直接缓冲区和直接缓冲区"}},[n._v("#")]),n._v(" 5、非直接缓冲区和直接缓冲区")]),n._v(" "),t("h4",{attrs:{id:"非直接缓冲区"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#非直接缓冲区"}},[n._v("#")]),n._v(" 非直接缓冲区")]),n._v(" "),t("p",[n._v("通过"),t("strong",[n._v("allocate()"),t("strong",[n._v("方法获取的缓冲区都是非直接缓冲区。这些缓冲区是建立在JVM")]),n._v("堆内存")]),n._v("之中的。")]),n._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v("public static ByteBuffer allocate(int capacity) {\n    if (capacity < 0)\n    throw new IllegalArgumentException();\n\n    // 在堆内存中开辟空间\n    return new HeapByteBuffer(capacity, capacity);\n}\n\nHeapByteBuffer(int cap, int lim) {        // package-private\n    // new byte[cap] 创建数组，在堆内存中开辟空间\n    super(-1, 0, lim, cap, new byte[cap], 0);\n    /*\n    hb = new byte[cap];\n    offset = 0;\n    */\n}Copy\n")])]),n._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[n._v("1")]),t("br"),t("span",{staticClass:"line-number"},[n._v("2")]),t("br"),t("span",{staticClass:"line-number"},[n._v("3")]),t("br"),t("span",{staticClass:"line-number"},[n._v("4")]),t("br"),t("span",{staticClass:"line-number"},[n._v("5")]),t("br"),t("span",{staticClass:"line-number"},[n._v("6")]),t("br"),t("span",{staticClass:"line-number"},[n._v("7")]),t("br"),t("span",{staticClass:"line-number"},[n._v("8")]),t("br"),t("span",{staticClass:"line-number"},[n._v("9")]),t("br"),t("span",{staticClass:"line-number"},[n._v("10")]),t("br"),t("span",{staticClass:"line-number"},[n._v("11")]),t("br"),t("span",{staticClass:"line-number"},[n._v("12")]),t("br"),t("span",{staticClass:"line-number"},[n._v("13")]),t("br"),t("span",{staticClass:"line-number"},[n._v("14")]),t("br"),t("span",{staticClass:"line-number"},[n._v("15")]),t("br"),t("span",{staticClass:"line-number"},[n._v("16")]),t("br")])]),t("p",[t("a",{attrs:{href:"https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201109151057.png",target:"_blank",rel:"noopener noreferrer"}},[t("img",{attrs:{src:"https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201109151057.png",alt:"img"}}),t("OutboundLink")],1)]),n._v(" "),t("p",[n._v("通过非直接缓冲区，想要将数据写入到物理磁盘中，或者是从物理磁盘读取数据。"),t("strong",[n._v("都需要经过JVM和操作系统")]),n._v("，数据在两个地址空间中传输时，会****一份保存在对方的空间中。所以费直接缓冲区的读取效率较低")]),n._v(" "),t("h4",{attrs:{id:"直接缓冲区"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#直接缓冲区"}},[n._v("#")]),n._v(" 直接缓冲区")]),n._v(" "),t("p",[t("strong",[n._v("只有ByteBuffer可以获得直接缓冲区")]),n._v("，通过allocateDirect()获取的缓冲区为直接缓冲区，这些缓冲区是建立在"),t("strong",[n._v("物理内存")]),n._v("之中的。")]),n._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v("public static ByteBuffer allocateDirect(int capacity) {\n    return new DirectByteBuffer(capacity);\n}\n\nDirectByteBuffer(int cap) {                   // package-private\n\t...\n    // 申请物理内存\n\tboolean pa = VM.isDirectMemoryPageAligned();\n\t...\n}Copy\n")])]),n._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[n._v("1")]),t("br"),t("span",{staticClass:"line-number"},[n._v("2")]),t("br"),t("span",{staticClass:"line-number"},[n._v("3")]),t("br"),t("span",{staticClass:"line-number"},[n._v("4")]),t("br"),t("span",{staticClass:"line-number"},[n._v("5")]),t("br"),t("span",{staticClass:"line-number"},[n._v("6")]),t("br"),t("span",{staticClass:"line-number"},[n._v("7")]),t("br"),t("span",{staticClass:"line-number"},[n._v("8")]),t("br"),t("span",{staticClass:"line-number"},[n._v("9")]),t("br"),t("span",{staticClass:"line-number"},[n._v("10")]),t("br")])]),t("p",[t("a",{attrs:{href:"https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201109151520.png",target:"_blank",rel:"noopener noreferrer"}},[t("img",{attrs:{src:"https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201109151520.png",alt:"img"}}),t("OutboundLink")],1)]),n._v(" "),t("p",[n._v("直接缓冲区通过在操作系统和JVM之间创建"),t("strong",[n._v("物理内存映射文件")]),n._v("加快缓冲区数据读/写入物理磁盘的速度。放到物理内存映射文件中的数据就不归应用程序控制了，操作系统会自动将物理内存映射文件中的数据写入到物理内存中")]),n._v(" "),t("h2",{attrs:{id:"五、通道-channel"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#五、通道-channel"}},[n._v("#")]),n._v(" 五、通道(Channel)")]),n._v(" "),t("h3",{attrs:{id:"_1、简介"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、简介"}},[n._v("#")]),n._v(" 1、简介")]),n._v(" "),t("p",[n._v("Channel由java.nio.channels 包定义的。Channel 表示"),t("strong",[n._v("IO 源与目标打开的连接")]),n._v("。Channel 类似于传统的“流”。只不过"),t("strong",[n._v("Channel 本身不能直接访问数据，Channel 只能与Buffer 进行交互")])]),n._v(" "),t("h3",{attrs:{id:"_2、图解"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2、图解"}},[n._v("#")]),n._v(" 2、图解")]),n._v(" "),t("p",[n._v("应用程序进行读写操作调用函数时，"),t("strong",[n._v("底层调用的操作系统提供给用户的读写API")]),n._v("，调用这些API时会生成对应的指令，CPU则会执行这些指令。在计算机刚出现的那段时间，"),t("strong",[n._v("所有读写请求的指令都有CPU去执行")]),n._v("，过多的读写请求会导致CPU无法去执行其他命令，从而CPU的利用率降低")]),n._v(" "),t("p",[t("a",{attrs:{href:"https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201109153039.png",target:"_blank",rel:"noopener noreferrer"}},[t("img",{attrs:{src:"https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201109153039.png",alt:"img"}}),t("OutboundLink")],1)]),n._v(" "),t("p",[n._v("后来，"),t("strong",[n._v("DMA")]),n._v("(Direct Memory Access，直接存储器访问)出现了。当IO请求传到计算机底层时，"),t("strong",[n._v("DMA会向CPU请求，让DMA去处理这些IO操作")]),n._v("，从而可以让CPU去执行其他指令。DMA处理IO操作时，会请求获取总线的使用权。"),t("strong",[n._v("当IO请求过多时，会导致大量总线用于处理IO请求，从而降低效率")])]),n._v(" "),t("p",[t("a",{attrs:{href:"https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201109153439.png",target:"_blank",rel:"noopener noreferrer"}},[t("img",{attrs:{src:"https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201109153439.png",alt:"img"}}),t("OutboundLink")],1)]),n._v(" "),t("p",[n._v("于是便有了"),t("strong",[n._v("Channel(通道)")]),n._v("，Channel相当于一个"),t("strong",[n._v("专门用于IO操作的独立处理器")]),n._v("，它具有独立处理IO请求的能力，当有IO请求时，它会自行处理这些IO请求")]),n._v(" "),t("p",[t("a",{attrs:{href:"https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201109154113.png",target:"_blank",rel:"noopener noreferrer"}},[t("img",{attrs:{src:"https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201109154113.png",alt:"img"}}),t("OutboundLink")],1)]),n._v(" "),t("h3",{attrs:{id:"_3、java-channel"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3、java-channel"}},[n._v("#")]),n._v(" 3、Java Channel")]),n._v(" "),t("h4",{attrs:{id:"常用实现类"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#常用实现类"}},[n._v("#")]),n._v(" 常用实现类")]),n._v(" "),t("p",[t("a",{attrs:{href:"https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201109154803.png",target:"_blank",rel:"noopener noreferrer"}},[t("img",{attrs:{src:"https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201109154803.png",alt:"img"}}),t("OutboundLink")],1)]),n._v(" "),t("ul",[t("li",[n._v("本地文件IO\n"),t("ul",[t("li",[n._v("FileChannel")])])]),n._v(" "),t("li",[n._v("网络IO\n"),t("ul",[t("li",[n._v("SocketChanel、ServerSocketChannel：用于TCP传输")]),n._v(" "),t("li",[n._v("DatagramChannel：用于UDP传输")])])])]),n._v(" "),t("h4",{attrs:{id:"获得通道的方法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#获得通道的方法"}},[n._v("#")]),n._v(" 获得通道的方法")]),n._v(" "),t("p",[n._v("获取通道的一种方式是对支持通道的"),t("strong",[n._v("对象调用getChannel() 方法")]),n._v("。支持通道的类如下：")]),n._v(" "),t("ul",[t("li",[n._v("FileInputStream")]),n._v(" "),t("li",[n._v("FileOutputStream")]),n._v(" "),t("li",[n._v("RandomAccessFile")]),n._v(" "),t("li",[n._v("DatagramSocket")]),n._v(" "),t("li",[n._v("Socket")]),n._v(" "),t("li",[n._v("ServerSocket")])]),n._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v('public class Demo2 {\n   public static void main(String[] args) throws IOException {\n      // 本地通道\n      FileInputStream fileInputStream = new FileInputStream("");\n      FileChannel channel1 = fileInputStream.getChannel();\n\n      FileOutputStream fileOutputStream = new FileOutputStream("");\n      FileChannel channel2 = fileOutputStream.getChannel();\n   \n      // 网络通道\n      Socket socket = new Socket();\n      SocketChannel channel3 = socket.getChannel();\n      \n      ServerSocket serverSocket = new ServerSocket();\n      ServerSocketChannel channel4 = serverSocket.getChannel();\n\n      DatagramSocket datagramSocket = new DatagramSocket();\n      DatagramChannel channel5 = datagramSocket.getChannel();\n       \n      // 最后要关闭通道\n       \n   }\n}Copy\n')])]),n._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[n._v("1")]),t("br"),t("span",{staticClass:"line-number"},[n._v("2")]),t("br"),t("span",{staticClass:"line-number"},[n._v("3")]),t("br"),t("span",{staticClass:"line-number"},[n._v("4")]),t("br"),t("span",{staticClass:"line-number"},[n._v("5")]),t("br"),t("span",{staticClass:"line-number"},[n._v("6")]),t("br"),t("span",{staticClass:"line-number"},[n._v("7")]),t("br"),t("span",{staticClass:"line-number"},[n._v("8")]),t("br"),t("span",{staticClass:"line-number"},[n._v("9")]),t("br"),t("span",{staticClass:"line-number"},[n._v("10")]),t("br"),t("span",{staticClass:"line-number"},[n._v("11")]),t("br"),t("span",{staticClass:"line-number"},[n._v("12")]),t("br"),t("span",{staticClass:"line-number"},[n._v("13")]),t("br"),t("span",{staticClass:"line-number"},[n._v("14")]),t("br"),t("span",{staticClass:"line-number"},[n._v("15")]),t("br"),t("span",{staticClass:"line-number"},[n._v("16")]),t("br"),t("span",{staticClass:"line-number"},[n._v("17")]),t("br"),t("span",{staticClass:"line-number"},[n._v("18")]),t("br"),t("span",{staticClass:"line-number"},[n._v("19")]),t("br"),t("span",{staticClass:"line-number"},[n._v("20")]),t("br"),t("span",{staticClass:"line-number"},[n._v("21")]),t("br"),t("span",{staticClass:"line-number"},[n._v("22")]),t("br"),t("span",{staticClass:"line-number"},[n._v("23")]),t("br")])]),t("p",[t("strong",[n._v("也可以通过通道的静态方法open()来获取")])]),n._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v('public static void main(String[] args) throws IOException {\n   FileChannel open = FileChannel.open(Paths.get(""));\n   \n   SocketChannel open1 = SocketChannel.open();\n   \n   ...\n}Copy\n')])]),n._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[n._v("1")]),t("br"),t("span",{staticClass:"line-number"},[n._v("2")]),t("br"),t("span",{staticClass:"line-number"},[n._v("3")]),t("br"),t("span",{staticClass:"line-number"},[n._v("4")]),t("br"),t("span",{staticClass:"line-number"},[n._v("5")]),t("br"),t("span",{staticClass:"line-number"},[n._v("6")]),t("br"),t("span",{staticClass:"line-number"},[n._v("7")]),t("br")])]),t("h4",{attrs:{id:"getchannel-非直接缓冲区"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#getchannel-非直接缓冲区"}},[n._v("#")]),n._v(" getChannel()+非直接缓冲区")]),n._v(" "),t("ul",[t("li",[n._v("getChannel()获得通道")]),n._v(" "),t("li",[n._v("allocate()获得"),t("strong",[n._v("非直接缓冲区")])])]),n._v(" "),t("p",[n._v("通过非直接缓冲区读写数据，需要通过通道来传输缓冲区里的数据")]),n._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v('public class Demo4 {\n   public static void main(String[] args) {\n      FileInputStream is = null;\n      FileOutputStream os = null;\n      // 获得通道\n      FileChannel inChannel = null;\n      FileChannel outChannel = null;\n       \n      // 利用 try-catch-finally 保证关闭\n      try {\n         is = new FileInputStream("F:\\\\JDKLearning\\\\src\\\\main\\\\NIO\\\\day1\\\\1.jpg");\n         os = new FileOutputStream("F:\\\\JDKLearning\\\\src\\\\main\\\\NIO\\\\day1\\\\2.jpg");\n\n         // 获得通道\n         inChannel = is.getChannel();\n         outChannel = os.getChannel();\n\n         // 获得缓冲区，用于在通道中传输数据\n         ByteBuffer byteBuffer = ByteBuffer.allocate(1024);\n\n         // 循环将字节数据放入到buffer中，然后写入磁盘中\n         while (inChannel.read(byteBuffer) != -1) {\n            // 切换模式\n            byteBuffer.flip();\n            outChannel.write(byteBuffer);\n            byteBuffer.clear();\n         }\n      } catch (IOException e) {\n         e.printStackTrace();\n      } finally {\n         if (inChannel != null) {\n            try {\n               inChannel.close();\n            } catch (IOException e) {\n               e.printStackTrace();\n            }\n         }\n         if (outChannel != null) {\n            try {\n               outChannel.close();\n            } catch (IOException e) {\n               e.printStackTrace();\n            }\n         }\n         if (is != null) {\n            try {\n               is.close();\n            } catch (IOException e) {\n               e.printStackTrace();\n            }\n         }\n         if (os != null) {\n            try {\n               os.close();\n            } catch (IOException e) {\n               e.printStackTrace();\n            }\n         }\n      }\n   }\n}Copy\n')])]),n._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[n._v("1")]),t("br"),t("span",{staticClass:"line-number"},[n._v("2")]),t("br"),t("span",{staticClass:"line-number"},[n._v("3")]),t("br"),t("span",{staticClass:"line-number"},[n._v("4")]),t("br"),t("span",{staticClass:"line-number"},[n._v("5")]),t("br"),t("span",{staticClass:"line-number"},[n._v("6")]),t("br"),t("span",{staticClass:"line-number"},[n._v("7")]),t("br"),t("span",{staticClass:"line-number"},[n._v("8")]),t("br"),t("span",{staticClass:"line-number"},[n._v("9")]),t("br"),t("span",{staticClass:"line-number"},[n._v("10")]),t("br"),t("span",{staticClass:"line-number"},[n._v("11")]),t("br"),t("span",{staticClass:"line-number"},[n._v("12")]),t("br"),t("span",{staticClass:"line-number"},[n._v("13")]),t("br"),t("span",{staticClass:"line-number"},[n._v("14")]),t("br"),t("span",{staticClass:"line-number"},[n._v("15")]),t("br"),t("span",{staticClass:"line-number"},[n._v("16")]),t("br"),t("span",{staticClass:"line-number"},[n._v("17")]),t("br"),t("span",{staticClass:"line-number"},[n._v("18")]),t("br"),t("span",{staticClass:"line-number"},[n._v("19")]),t("br"),t("span",{staticClass:"line-number"},[n._v("20")]),t("br"),t("span",{staticClass:"line-number"},[n._v("21")]),t("br"),t("span",{staticClass:"line-number"},[n._v("22")]),t("br"),t("span",{staticClass:"line-number"},[n._v("23")]),t("br"),t("span",{staticClass:"line-number"},[n._v("24")]),t("br"),t("span",{staticClass:"line-number"},[n._v("25")]),t("br"),t("span",{staticClass:"line-number"},[n._v("26")]),t("br"),t("span",{staticClass:"line-number"},[n._v("27")]),t("br"),t("span",{staticClass:"line-number"},[n._v("28")]),t("br"),t("span",{staticClass:"line-number"},[n._v("29")]),t("br"),t("span",{staticClass:"line-number"},[n._v("30")]),t("br"),t("span",{staticClass:"line-number"},[n._v("31")]),t("br"),t("span",{staticClass:"line-number"},[n._v("32")]),t("br"),t("span",{staticClass:"line-number"},[n._v("33")]),t("br"),t("span",{staticClass:"line-number"},[n._v("34")]),t("br"),t("span",{staticClass:"line-number"},[n._v("35")]),t("br"),t("span",{staticClass:"line-number"},[n._v("36")]),t("br"),t("span",{staticClass:"line-number"},[n._v("37")]),t("br"),t("span",{staticClass:"line-number"},[n._v("38")]),t("br"),t("span",{staticClass:"line-number"},[n._v("39")]),t("br"),t("span",{staticClass:"line-number"},[n._v("40")]),t("br"),t("span",{staticClass:"line-number"},[n._v("41")]),t("br"),t("span",{staticClass:"line-number"},[n._v("42")]),t("br"),t("span",{staticClass:"line-number"},[n._v("43")]),t("br"),t("span",{staticClass:"line-number"},[n._v("44")]),t("br"),t("span",{staticClass:"line-number"},[n._v("45")]),t("br"),t("span",{staticClass:"line-number"},[n._v("46")]),t("br"),t("span",{staticClass:"line-number"},[n._v("47")]),t("br"),t("span",{staticClass:"line-number"},[n._v("48")]),t("br"),t("span",{staticClass:"line-number"},[n._v("49")]),t("br"),t("span",{staticClass:"line-number"},[n._v("50")]),t("br"),t("span",{staticClass:"line-number"},[n._v("51")]),t("br"),t("span",{staticClass:"line-number"},[n._v("52")]),t("br"),t("span",{staticClass:"line-number"},[n._v("53")]),t("br"),t("span",{staticClass:"line-number"},[n._v("54")]),t("br"),t("span",{staticClass:"line-number"},[n._v("55")]),t("br"),t("span",{staticClass:"line-number"},[n._v("56")]),t("br"),t("span",{staticClass:"line-number"},[n._v("57")]),t("br"),t("span",{staticClass:"line-number"},[n._v("58")]),t("br"),t("span",{staticClass:"line-number"},[n._v("59")]),t("br"),t("span",{staticClass:"line-number"},[n._v("60")]),t("br"),t("span",{staticClass:"line-number"},[n._v("61")]),t("br")])]),t("p",[t("strong",[n._v("图片读取后，被写入到了指定位置")]),t("a",{attrs:{href:"https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201109211055.png",target:"_blank",rel:"noopener noreferrer"}},[t("img",{attrs:{src:"https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201109211055.png",alt:"img"}}),t("OutboundLink")],1)]),n._v(" "),t("h4",{attrs:{id:"open-直接缓冲区"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#open-直接缓冲区"}},[n._v("#")]),n._v(" open()+直接缓冲区")]),n._v(" "),t("ul",[t("li",[n._v("通过open获得通道")]),n._v(" "),t("li",[n._v("通过FileChannel.map()获取直接缓冲区")])]),n._v(" "),t("p",[n._v("使用直接缓冲区时，无需通过通道来传输数据，直接将数据放在缓冲区内即可")]),n._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v('public class Demo5 {\n   public static void main(String[] args) throws IOException {\n      // 通过open()方法来获得通道\n      FileChannel inChannel = FileChannel.open(Paths.get("F:\\\\JDKLearning\\\\src\\\\main\\\\NIO\\\\day1\\\\1.jpg"), StandardOpenOption.READ);\n\n      // outChannel需要为 READ WRITE CREATE模式\n      // READ WRITE是因为后面获取直接缓冲区时模式为READ_WRITE模式\n      // CREATE是因为要创建新的文件\n      FileChannel outChannel = FileChannel.open(Paths.get("F:\\\\JDKLearning\\\\src\\\\main\\\\NIO\\\\day1\\\\3.jpg"), StandardOpenOption.READ, StandardOpenOption.WRITE, StandardOpenOption.CREATE);\n\n      // 获得直接缓冲区\n      MappedByteBuffer inMapBuf = inChannel.map(FileChannel.MapMode.READ_ONLY, 0, inChannel.size());\n      MappedByteBuffer outMapBuf = outChannel.map(FileChannel.MapMode.READ_WRITE, 0, inChannel.size());\n\n      // 字节数组\n      byte[] bytes = new byte[inMapBuf.limit()];\n\n      // 因为是直接缓冲区，可以直接将数据放入到内存映射文件，无需通过通道传输\n      inMapBuf.get(bytes);\n      outMapBuf.put(bytes);\n\n      // 关闭缓冲区，这里没有用try-catch-finally\n      inChannel.close();\n      outChannel.close();\n   }\n}Copy\n')])]),n._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[n._v("1")]),t("br"),t("span",{staticClass:"line-number"},[n._v("2")]),t("br"),t("span",{staticClass:"line-number"},[n._v("3")]),t("br"),t("span",{staticClass:"line-number"},[n._v("4")]),t("br"),t("span",{staticClass:"line-number"},[n._v("5")]),t("br"),t("span",{staticClass:"line-number"},[n._v("6")]),t("br"),t("span",{staticClass:"line-number"},[n._v("7")]),t("br"),t("span",{staticClass:"line-number"},[n._v("8")]),t("br"),t("span",{staticClass:"line-number"},[n._v("9")]),t("br"),t("span",{staticClass:"line-number"},[n._v("10")]),t("br"),t("span",{staticClass:"line-number"},[n._v("11")]),t("br"),t("span",{staticClass:"line-number"},[n._v("12")]),t("br"),t("span",{staticClass:"line-number"},[n._v("13")]),t("br"),t("span",{staticClass:"line-number"},[n._v("14")]),t("br"),t("span",{staticClass:"line-number"},[n._v("15")]),t("br"),t("span",{staticClass:"line-number"},[n._v("16")]),t("br"),t("span",{staticClass:"line-number"},[n._v("17")]),t("br"),t("span",{staticClass:"line-number"},[n._v("18")]),t("br"),t("span",{staticClass:"line-number"},[n._v("19")]),t("br"),t("span",{staticClass:"line-number"},[n._v("20")]),t("br"),t("span",{staticClass:"line-number"},[n._v("21")]),t("br"),t("span",{staticClass:"line-number"},[n._v("22")]),t("br"),t("span",{staticClass:"line-number"},[n._v("23")]),t("br"),t("span",{staticClass:"line-number"},[n._v("24")]),t("br"),t("span",{staticClass:"line-number"},[n._v("25")]),t("br"),t("span",{staticClass:"line-number"},[n._v("26")]),t("br")])]),t("p",[t("strong",[n._v("运行结果，图片被创建")]),t("a",{attrs:{href:"https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201109214801.png",target:"_blank",rel:"noopener noreferrer"}},[t("img",{attrs:{src:"https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201109214801.png",alt:"img"}}),t("OutboundLink")],1)]),n._v(" "),t("h4",{attrs:{id:"通道间直接传输"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#通道间直接传输"}},[n._v("#")]),n._v(" 通道间直接传输")]),n._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v('public static void channelToChannel() throws IOException {\n   long start = System.currentTimeMillis();\n   // 通过open()方法来获得通道\n   FileChannel inChannel = FileChannel.open(Paths.get("F:\\\\JDKLearning\\\\src\\\\main\\\\NIO\\\\day1\\\\1.mp4"), StandardOpenOption.READ);\n\n   // outChannel需要为 READ WRITE CREATE模式\n   // READ WRITE是因为后面获取直接缓冲区时模式为READ_WRITE模式\n   // CREATE是因为要创建新的文件\n   FileChannel outChannel = FileChannel.open(Paths.get("F:\\\\JDKLearning\\\\src\\\\main\\\\NIO\\\\day1\\\\4.mp4"), StandardOpenOption.READ, StandardOpenOption.WRITE, StandardOpenOption.CREATE);\n\n   // 通道间直接传输\n   inChannel.transferTo(0, inChannel.size(), outChannel);\n   // 对应的还有transferFrom\n   // outChannel.transferFrom(inChannel, 0, inChannel.size());\n\n   inChannel.close();\n   outChannel.close();\n}Copy\n')])]),n._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[n._v("1")]),t("br"),t("span",{staticClass:"line-number"},[n._v("2")]),t("br"),t("span",{staticClass:"line-number"},[n._v("3")]),t("br"),t("span",{staticClass:"line-number"},[n._v("4")]),t("br"),t("span",{staticClass:"line-number"},[n._v("5")]),t("br"),t("span",{staticClass:"line-number"},[n._v("6")]),t("br"),t("span",{staticClass:"line-number"},[n._v("7")]),t("br"),t("span",{staticClass:"line-number"},[n._v("8")]),t("br"),t("span",{staticClass:"line-number"},[n._v("9")]),t("br"),t("span",{staticClass:"line-number"},[n._v("10")]),t("br"),t("span",{staticClass:"line-number"},[n._v("11")]),t("br"),t("span",{staticClass:"line-number"},[n._v("12")]),t("br"),t("span",{staticClass:"line-number"},[n._v("13")]),t("br"),t("span",{staticClass:"line-number"},[n._v("14")]),t("br"),t("span",{staticClass:"line-number"},[n._v("15")]),t("br"),t("span",{staticClass:"line-number"},[n._v("16")]),t("br"),t("span",{staticClass:"line-number"},[n._v("17")]),t("br"),t("span",{staticClass:"line-number"},[n._v("18")]),t("br")])]),t("h4",{attrs:{id:"直接缓冲区vs非直接缓冲区"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#直接缓冲区vs非直接缓冲区"}},[n._v("#")]),n._v(" 直接缓冲区VS非直接缓冲区")]),n._v(" "),t("p",[t("strong",[n._v("效率")])]),n._v(" "),t("p",[n._v("读取一个MP4文件，通过二者花费时间的多少来判定执行的速度")]),n._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v("// getChannel() + 非直接缓冲区耗时\n708\n// open() + 直接缓冲区耗时\n115\n// channel transferTo channel耗时\n47Copy\n")])]),n._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[n._v("1")]),t("br"),t("span",{staticClass:"line-number"},[n._v("2")]),t("br"),t("span",{staticClass:"line-number"},[n._v("3")]),t("br"),t("span",{staticClass:"line-number"},[n._v("4")]),t("br"),t("span",{staticClass:"line-number"},[n._v("5")]),t("br"),t("span",{staticClass:"line-number"},[n._v("6")]),t("br")])]),t("p",[t("strong",[n._v("内存占用")])]),n._v(" "),t("p",[n._v("直接缓冲区的读写速度虽然很快，但是会占用很多很多内存空间。如果文件过大，会使得计算机运行速度变慢")]),n._v(" "),t("h3",{attrs:{id:"_4、分散和聚集"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4、分散和聚集"}},[n._v("#")]),n._v(" 4、分散和聚集")]),n._v(" "),t("h4",{attrs:{id:"分散读取"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#分散读取"}},[n._v("#")]),n._v(" 分散读取")]),n._v(" "),t("p",[n._v("分散读取（Scattering Reads）是指"),t("strong",[n._v("从Channel 中读取的数据“分散”到多个Buffer 中")])]),n._v(" "),t("p",[t("strong",[n._v("注意")]),n._v("：按照缓冲区的"),t("strong",[n._v("顺序")]),n._v("，从Channel 中读取的数据依次将 Buffer 填满")]),n._v(" "),t("p",[t("a",{attrs:{href:"https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201111082427.png",target:"_blank",rel:"noopener noreferrer"}},[t("img",{attrs:{src:"https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201111082427.png",alt:"img"}}),t("OutboundLink")],1)]),n._v(" "),t("h4",{attrs:{id:"聚集写入"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#聚集写入"}},[n._v("#")]),n._v(" 聚集写入")]),n._v(" "),t("p",[n._v("聚集写入（Gathering Writes）是指将"),t("strong",[n._v("多个Buffer 中的数据“聚集”到Channel")])]),n._v(" "),t("p",[n._v("按照缓冲区的"),t("strong",[n._v("顺序")]),n._v("，写入position 和limit 之间的数据到Channel")]),n._v(" "),t("p",[t("a",{attrs:{href:"https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201111082547.png",target:"_blank",rel:"noopener noreferrer"}},[t("img",{attrs:{src:"https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201111082547.png",alt:"img"}}),t("OutboundLink")],1)]),n._v(" "),t("p",[t("strong",[n._v("代码")])]),n._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v('public class Demo2 {\n   public static void main(String[] args) throws IOException {\n      FileInputStream is = new FileInputStream("F:\\\\JDKLearning\\\\src\\\\main\\\\nio\\\\day2\\\\计划.txt");\n      FileOutputStream os = new FileOutputStream("F:\\\\JDKLearning\\\\src\\\\main\\\\nio\\\\day2\\\\计划2.txt");\n\n      FileChannel inChannel = is.getChannel();\n      FileChannel outChannel = os.getChannel();\n\n      // 获得多个缓冲区，并且放入到缓冲区数组中\n      ByteBuffer byteBuffer1 = ByteBuffer.allocate(50);\n      ByteBuffer byteBuffer2 = ByteBuffer.allocate(1024);\n      ByteBuffer[] byteBuffers = {byteBuffer1, byteBuffer2};\n\n      // 分散读取\n      inChannel.read(byteBuffers);\n      \n      byteBuffer1.flip();\n      byteBuffer2.flip();\n      \n      // 聚集写入\n      outChannel.write(byteBuffers);\n   }\n}Copy\n')])]),n._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[n._v("1")]),t("br"),t("span",{staticClass:"line-number"},[n._v("2")]),t("br"),t("span",{staticClass:"line-number"},[n._v("3")]),t("br"),t("span",{staticClass:"line-number"},[n._v("4")]),t("br"),t("span",{staticClass:"line-number"},[n._v("5")]),t("br"),t("span",{staticClass:"line-number"},[n._v("6")]),t("br"),t("span",{staticClass:"line-number"},[n._v("7")]),t("br"),t("span",{staticClass:"line-number"},[n._v("8")]),t("br"),t("span",{staticClass:"line-number"},[n._v("9")]),t("br"),t("span",{staticClass:"line-number"},[n._v("10")]),t("br"),t("span",{staticClass:"line-number"},[n._v("11")]),t("br"),t("span",{staticClass:"line-number"},[n._v("12")]),t("br"),t("span",{staticClass:"line-number"},[n._v("13")]),t("br"),t("span",{staticClass:"line-number"},[n._v("14")]),t("br"),t("span",{staticClass:"line-number"},[n._v("15")]),t("br"),t("span",{staticClass:"line-number"},[n._v("16")]),t("br"),t("span",{staticClass:"line-number"},[n._v("17")]),t("br"),t("span",{staticClass:"line-number"},[n._v("18")]),t("br"),t("span",{staticClass:"line-number"},[n._v("19")]),t("br"),t("span",{staticClass:"line-number"},[n._v("20")]),t("br"),t("span",{staticClass:"line-number"},[n._v("21")]),t("br"),t("span",{staticClass:"line-number"},[n._v("22")]),t("br"),t("span",{staticClass:"line-number"},[n._v("23")]),t("br")])]),t("p",[t("a",{attrs:{href:"https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201111083219.png",target:"_blank",rel:"noopener noreferrer"}},[t("img",{attrs:{src:"https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201111083219.png",alt:"img"}}),t("OutboundLink")],1)]),n._v(" "),t("p",[t("a",{attrs:{href:"https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201111083230.png",target:"_blank",rel:"noopener noreferrer"}},[t("img",{attrs:{src:"https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201111083230.png",alt:"img"}}),t("OutboundLink")],1)]),n._v(" "),t("h2",{attrs:{id:"六、非阻塞式网络通信"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#六、非阻塞式网络通信"}},[n._v("#")]),n._v(" 六、非阻塞式网络通信")]),n._v(" "),t("h3",{attrs:{id:"_1、概念"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、概念"}},[n._v("#")]),n._v(" 1、概念")]),n._v(" "),t("h4",{attrs:{id:"举例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#举例"}},[n._v("#")]),n._v(" 举例")]),n._v(" "),t("p",[n._v("双11买的快递到了，快递小哥给你打电话说马上到小区门口，麻烦在门口等一下，方便签收快递")]),n._v(" "),t("ul",[t("li",[n._v("若为"),t("strong",[n._v("阻塞式")]),n._v("的，你到了小区门口以后，快递小哥还没到的期间，你什么事儿也做不了")]),n._v(" "),t("li",[n._v("若为"),t("strong",[n._v("非阻塞式")]),n._v("的，快递小哥将快递放到门卫处，门卫给你发消息说快递到了，麻烦去取一下。当快递还没到的时候你可以做你自己的事儿")])]),n._v(" "),t("h4",{attrs:{id:"阻塞式网络通信"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#阻塞式网络通信"}},[n._v("#")]),n._v(" 阻塞式网络通信")]),n._v(" "),t("p",[n._v("传统的IO 流都是阻塞式的。也就是说，当一个线程调用read() 或write() 时，"),t("strong",[n._v("该线程被阻塞")]),n._v("，直到有一些数据被读取或写入，该线程在此期间不能执行其他任务")]),n._v(" "),t("p",[n._v("因此，在完成网络通信进行IO 操作时，由于线程会阻塞，所以"),t("strong",[n._v("服务器端必须为每个客户端都提供一个独立的线程进行处理")]),n._v("，当服务器端需要处理大量客户端时，"),t("strong",[n._v("性能急剧下降")])]),n._v(" "),t("p",[n._v("也就是说，服务器在等待IO准备就绪的期间，"),t("strong",[n._v("线程处于阻塞状态")]),n._v("，若为单线程，等待期间CPU未执行任何任务，效率降低。所以需要开启多个线程，当某些线程因为等待IO准备就绪时，CPU可以去执行其他线程中的任务。但是线程的创建、切换与销毁的开销也是不小的。当大量的任务到来时，服务器性能也急剧下降。")]),n._v(" "),t("p",[t("a",{attrs:{href:"https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201111090126.png",target:"_blank",rel:"noopener noreferrer"}},[t("img",{attrs:{src:"https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201111090126.png",alt:"img"}}),t("OutboundLink")],1)]),n._v(" "),t("h4",{attrs:{id:"非阻塞式网络通信"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#非阻塞式网络通信"}},[n._v("#")]),n._v(" 非阻塞式网络通信")]),n._v(" "),t("p",[n._v("Java NIO 是非阻塞模式的。当线程从某通道进行读写数据时，"),t("strong",[n._v("若没有数据可用时，该线程可以进行其他任务")]),n._v("。线程通常将非阻塞IO 的空闲时间用于在其他通道上执行IO 操作，所以"),t("strong",[n._v("单独的线程可以管理多个输入和输出通道")])]),n._v(" "),t("p",[n._v("因此，NIO 可以让服务器端"),t("strong",[n._v("使用一个或有限几个线程来同时处理连接到服务器端的所有客户端")])]),n._v(" "),t("p",[t("a",{attrs:{href:"https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201112165417.png",target:"_blank",rel:"noopener noreferrer"}},[t("img",{attrs:{src:"https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201112165417.png",alt:"img"}}),t("OutboundLink")],1)]),n._v(" "),t("h3",{attrs:{id:"_2、使用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2、使用"}},[n._v("#")]),n._v(" 2、使用")]),n._v(" "),t("h4",{attrs:{id:"阻塞式网络通信演示"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#阻塞式网络通信演示"}},[n._v("#")]),n._v(" 阻塞式网络通信演示")]),n._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v('public class Demo1 {\n   public static void main(String[] args) throws IOException {\n      Thread thread1 = new Thread(()->{\n         try {\n            server();\n         } catch (IOException e) {\n            e.printStackTrace();\n         }\n      });\n\n      Thread thread2 = new Thread(()->{\n         try {\n            client();\n         } catch (IOException e) {\n            e.printStackTrace();\n         }\n      });\n\n      thread1.start();\n      thread2.start();\n   }\n\n   public static void client() throws IOException {\n      // 创建客户端通道\n      SocketChannel socketChannel = SocketChannel.open(new InetSocketAddress("127.0.0.1", 2022));\n\n      // 读取信息\n      FileChannel fileChannel = FileChannel.open(Paths.get("F:\\\\JDKLearning\\\\src\\\\main\\\\nio\\\\day3\\\\1.jpg"), StandardOpenOption.READ);\n\n      // 创建缓冲区\n      ByteBuffer byteBuffer = ByteBuffer.allocate(1024);\n\n      // 写入数据\n      while (fileChannel.read(byteBuffer) != -1) {\n         byteBuffer.flip();\n         socketChannel.write(byteBuffer);\n         byteBuffer.clear();\n      }\n\n      fileChannel.close();\n      socketChannel.close();\n   }\n\n   public static void server() throws IOException {\n      // 创建服务端通道\n      ServerSocketChannel serverSocketChannel = ServerSocketChannel.open();\n\n      FileChannel fileChannel = FileChannel.open(Paths.get("F:\\\\JDKLearning\\\\src\\\\main\\\\nio\\\\day3\\\\2.jpg"), StandardOpenOption.WRITE, StandardOpenOption.CREATE);\n\n      // 绑定链接\n      serverSocketChannel.bind(new InetSocketAddress(2022));\n\n      // 获取客户端的通道\n      SocketChannel socketChannel = serverSocketChannel.accept();\n\n      // 创建缓冲区\n      ByteBuffer byteBuffer = ByteBuffer.allocate(1024);\n\n      while (socketChannel.read(byteBuffer) != -1) {\n         byteBuffer.flip();\n         fileChannel.write(byteBuffer);\n         byteBuffer.clear();\n      }\n\n      socketChannel.close();\n      fileChannel.close();\n      serverSocketChannel.close();\n   }\n}Copy\n')])]),n._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[n._v("1")]),t("br"),t("span",{staticClass:"line-number"},[n._v("2")]),t("br"),t("span",{staticClass:"line-number"},[n._v("3")]),t("br"),t("span",{staticClass:"line-number"},[n._v("4")]),t("br"),t("span",{staticClass:"line-number"},[n._v("5")]),t("br"),t("span",{staticClass:"line-number"},[n._v("6")]),t("br"),t("span",{staticClass:"line-number"},[n._v("7")]),t("br"),t("span",{staticClass:"line-number"},[n._v("8")]),t("br"),t("span",{staticClass:"line-number"},[n._v("9")]),t("br"),t("span",{staticClass:"line-number"},[n._v("10")]),t("br"),t("span",{staticClass:"line-number"},[n._v("11")]),t("br"),t("span",{staticClass:"line-number"},[n._v("12")]),t("br"),t("span",{staticClass:"line-number"},[n._v("13")]),t("br"),t("span",{staticClass:"line-number"},[n._v("14")]),t("br"),t("span",{staticClass:"line-number"},[n._v("15")]),t("br"),t("span",{staticClass:"line-number"},[n._v("16")]),t("br"),t("span",{staticClass:"line-number"},[n._v("17")]),t("br"),t("span",{staticClass:"line-number"},[n._v("18")]),t("br"),t("span",{staticClass:"line-number"},[n._v("19")]),t("br"),t("span",{staticClass:"line-number"},[n._v("20")]),t("br"),t("span",{staticClass:"line-number"},[n._v("21")]),t("br"),t("span",{staticClass:"line-number"},[n._v("22")]),t("br"),t("span",{staticClass:"line-number"},[n._v("23")]),t("br"),t("span",{staticClass:"line-number"},[n._v("24")]),t("br"),t("span",{staticClass:"line-number"},[n._v("25")]),t("br"),t("span",{staticClass:"line-number"},[n._v("26")]),t("br"),t("span",{staticClass:"line-number"},[n._v("27")]),t("br"),t("span",{staticClass:"line-number"},[n._v("28")]),t("br"),t("span",{staticClass:"line-number"},[n._v("29")]),t("br"),t("span",{staticClass:"line-number"},[n._v("30")]),t("br"),t("span",{staticClass:"line-number"},[n._v("31")]),t("br"),t("span",{staticClass:"line-number"},[n._v("32")]),t("br"),t("span",{staticClass:"line-number"},[n._v("33")]),t("br"),t("span",{staticClass:"line-number"},[n._v("34")]),t("br"),t("span",{staticClass:"line-number"},[n._v("35")]),t("br"),t("span",{staticClass:"line-number"},[n._v("36")]),t("br"),t("span",{staticClass:"line-number"},[n._v("37")]),t("br"),t("span",{staticClass:"line-number"},[n._v("38")]),t("br"),t("span",{staticClass:"line-number"},[n._v("39")]),t("br"),t("span",{staticClass:"line-number"},[n._v("40")]),t("br"),t("span",{staticClass:"line-number"},[n._v("41")]),t("br"),t("span",{staticClass:"line-number"},[n._v("42")]),t("br"),t("span",{staticClass:"line-number"},[n._v("43")]),t("br"),t("span",{staticClass:"line-number"},[n._v("44")]),t("br"),t("span",{staticClass:"line-number"},[n._v("45")]),t("br"),t("span",{staticClass:"line-number"},[n._v("46")]),t("br"),t("span",{staticClass:"line-number"},[n._v("47")]),t("br"),t("span",{staticClass:"line-number"},[n._v("48")]),t("br"),t("span",{staticClass:"line-number"},[n._v("49")]),t("br"),t("span",{staticClass:"line-number"},[n._v("50")]),t("br"),t("span",{staticClass:"line-number"},[n._v("51")]),t("br"),t("span",{staticClass:"line-number"},[n._v("52")]),t("br"),t("span",{staticClass:"line-number"},[n._v("53")]),t("br"),t("span",{staticClass:"line-number"},[n._v("54")]),t("br"),t("span",{staticClass:"line-number"},[n._v("55")]),t("br"),t("span",{staticClass:"line-number"},[n._v("56")]),t("br"),t("span",{staticClass:"line-number"},[n._v("57")]),t("br"),t("span",{staticClass:"line-number"},[n._v("58")]),t("br"),t("span",{staticClass:"line-number"},[n._v("59")]),t("br"),t("span",{staticClass:"line-number"},[n._v("60")]),t("br"),t("span",{staticClass:"line-number"},[n._v("61")]),t("br"),t("span",{staticClass:"line-number"},[n._v("62")]),t("br"),t("span",{staticClass:"line-number"},[n._v("63")]),t("br"),t("span",{staticClass:"line-number"},[n._v("64")]),t("br"),t("span",{staticClass:"line-number"},[n._v("65")]),t("br"),t("span",{staticClass:"line-number"},[n._v("66")]),t("br"),t("span",{staticClass:"line-number"},[n._v("67")]),t("br"),t("span",{staticClass:"line-number"},[n._v("68")]),t("br"),t("span",{staticClass:"line-number"},[n._v("69")]),t("br")])]),t("h4",{attrs:{id:"非阻塞式网络通信演示"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#非阻塞式网络通信演示"}},[n._v("#")]),n._v(" 非阻塞式网络通信演示")]),n._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v('public class DemoNIO {\n\tpublic static void main(String[] args) {\n\t\tThread thread1 = new Thread(()->{\n\t\t\ttry {\n\t\t\t\tserver();\n\t\t\t} catch (IOException e) {\n\t\t\t\te.printStackTrace();\n\t\t\t}\n\t\t});\n\n\t\tThread thread2 = new Thread(()->{\n\t\t\ttry {\n\t\t\t\tclient();\n\t\t\t} catch (IOException e) {\n\t\t\t\te.printStackTrace();\n\t\t\t}\n\t\t});\n\t\tthread1.start();\n\t\tthread2.start();\n\t}\n\n\tpublic static void client() throws IOException {\n\t\tSocketChannel socketChannel = SocketChannel.open(new InetSocketAddress("127.0.0.1", 2020));\n\n\t\t// 设置为非阻塞模式\n\t\tsocketChannel.configureBlocking(false);\n\n\t\tByteBuffer byteBuffer = ByteBuffer.allocate(1024);\n\n\t\tScanner scanner = new Scanner(System.in);\n\t\twhile (scanner.hasNext()) {\n\t\t\tString str = scanner.next();\n\t\t\tbyteBuffer.put(str.getBytes());\n\t\t\tbyteBuffer.flip();\n\t\t\tsocketChannel.write(byteBuffer);\n\t\t\tbyteBuffer.clear();\n\t\t}\n\n\t\tbyteBuffer.clear();\n\n\t\tsocketChannel.close();\n\t}\n\n\tpublic static void server() throws IOException {\n\t\tServerSocketChannel serverSocketChannel = ServerSocketChannel.open();\n\t\tserverSocketChannel.configureBlocking(false);\n\t\tserverSocketChannel.bind(new InetSocketAddress(2020));\n\n\t\t// 获得选择器\n\t\tSelector selector = Selector.open();\n\n\t\t// 将通道注册到选择器中，设定为接收操作\n\t\tserverSocketChannel.register(selector, SelectionKey.OP_ACCEPT);\n\n\t\t// 轮训接受\n\t\twhile (selector.select() > 0) {\n\t\t\tIterator<SelectionKey> iterator = selector.selectedKeys().iterator();\n\t\t\t// 获得事件的key\n\t\t\twhile (iterator.hasNext()) {\n\t\t\t\tSelectionKey key = iterator.next();\n\t\t\t\tif (key.isAcceptable()) {\n\t\t\t\t\tSocketChannel socketChannel = serverSocketChannel.accept();\n\t\t\t\t\tsocketChannel.configureBlocking(false);\n\t\t\t\t\tsocketChannel.register(selector, SelectionKey.OP_READ);\n\t\t\t\t} else if (key.isReadable()) {\n\t\t\t\t\t// 从选择器中获取通道\n\t\t\t\t\tSocketChannel socketChannel = (SocketChannel) key.channel();\n\n\t\t\t\t\tByteBuffer byteBuffer = ByteBuffer.allocate(10);\n\n\t\t\t\t\twhile (socketChannel.read(byteBuffer) != -1) {\n\t\t\t\t\t\tint len = byteBuffer.limit();\n\t\t\t\t\t\tbyteBuffer.flip();\n\t\t\t\t\t\tSystem.out.println(new String(byteBuffer.array(), 0, len));\n\t\t\t\t\t\tbyteBuffer.clear();\n\t\t\t\t\t}\n\t\t\t\t\tsocketChannel.close();\n\t\t\t\t}\n\t\t\t\titerator.remove();\n\t\t\t}\n\t\t}\n\t\tserverSocketChannel.close();\n\t}\n}Copy\n')])]),n._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[n._v("1")]),t("br"),t("span",{staticClass:"line-number"},[n._v("2")]),t("br"),t("span",{staticClass:"line-number"},[n._v("3")]),t("br"),t("span",{staticClass:"line-number"},[n._v("4")]),t("br"),t("span",{staticClass:"line-number"},[n._v("5")]),t("br"),t("span",{staticClass:"line-number"},[n._v("6")]),t("br"),t("span",{staticClass:"line-number"},[n._v("7")]),t("br"),t("span",{staticClass:"line-number"},[n._v("8")]),t("br"),t("span",{staticClass:"line-number"},[n._v("9")]),t("br"),t("span",{staticClass:"line-number"},[n._v("10")]),t("br"),t("span",{staticClass:"line-number"},[n._v("11")]),t("br"),t("span",{staticClass:"line-number"},[n._v("12")]),t("br"),t("span",{staticClass:"line-number"},[n._v("13")]),t("br"),t("span",{staticClass:"line-number"},[n._v("14")]),t("br"),t("span",{staticClass:"line-number"},[n._v("15")]),t("br"),t("span",{staticClass:"line-number"},[n._v("16")]),t("br"),t("span",{staticClass:"line-number"},[n._v("17")]),t("br"),t("span",{staticClass:"line-number"},[n._v("18")]),t("br"),t("span",{staticClass:"line-number"},[n._v("19")]),t("br"),t("span",{staticClass:"line-number"},[n._v("20")]),t("br"),t("span",{staticClass:"line-number"},[n._v("21")]),t("br"),t("span",{staticClass:"line-number"},[n._v("22")]),t("br"),t("span",{staticClass:"line-number"},[n._v("23")]),t("br"),t("span",{staticClass:"line-number"},[n._v("24")]),t("br"),t("span",{staticClass:"line-number"},[n._v("25")]),t("br"),t("span",{staticClass:"line-number"},[n._v("26")]),t("br"),t("span",{staticClass:"line-number"},[n._v("27")]),t("br"),t("span",{staticClass:"line-number"},[n._v("28")]),t("br"),t("span",{staticClass:"line-number"},[n._v("29")]),t("br"),t("span",{staticClass:"line-number"},[n._v("30")]),t("br"),t("span",{staticClass:"line-number"},[n._v("31")]),t("br"),t("span",{staticClass:"line-number"},[n._v("32")]),t("br"),t("span",{staticClass:"line-number"},[n._v("33")]),t("br"),t("span",{staticClass:"line-number"},[n._v("34")]),t("br"),t("span",{staticClass:"line-number"},[n._v("35")]),t("br"),t("span",{staticClass:"line-number"},[n._v("36")]),t("br"),t("span",{staticClass:"line-number"},[n._v("37")]),t("br"),t("span",{staticClass:"line-number"},[n._v("38")]),t("br"),t("span",{staticClass:"line-number"},[n._v("39")]),t("br"),t("span",{staticClass:"line-number"},[n._v("40")]),t("br"),t("span",{staticClass:"line-number"},[n._v("41")]),t("br"),t("span",{staticClass:"line-number"},[n._v("42")]),t("br"),t("span",{staticClass:"line-number"},[n._v("43")]),t("br"),t("span",{staticClass:"line-number"},[n._v("44")]),t("br"),t("span",{staticClass:"line-number"},[n._v("45")]),t("br"),t("span",{staticClass:"line-number"},[n._v("46")]),t("br"),t("span",{staticClass:"line-number"},[n._v("47")]),t("br"),t("span",{staticClass:"line-number"},[n._v("48")]),t("br"),t("span",{staticClass:"line-number"},[n._v("49")]),t("br"),t("span",{staticClass:"line-number"},[n._v("50")]),t("br"),t("span",{staticClass:"line-number"},[n._v("51")]),t("br"),t("span",{staticClass:"line-number"},[n._v("52")]),t("br"),t("span",{staticClass:"line-number"},[n._v("53")]),t("br"),t("span",{staticClass:"line-number"},[n._v("54")]),t("br"),t("span",{staticClass:"line-number"},[n._v("55")]),t("br"),t("span",{staticClass:"line-number"},[n._v("56")]),t("br"),t("span",{staticClass:"line-number"},[n._v("57")]),t("br"),t("span",{staticClass:"line-number"},[n._v("58")]),t("br"),t("span",{staticClass:"line-number"},[n._v("59")]),t("br"),t("span",{staticClass:"line-number"},[n._v("60")]),t("br"),t("span",{staticClass:"line-number"},[n._v("61")]),t("br"),t("span",{staticClass:"line-number"},[n._v("62")]),t("br"),t("span",{staticClass:"line-number"},[n._v("63")]),t("br"),t("span",{staticClass:"line-number"},[n._v("64")]),t("br"),t("span",{staticClass:"line-number"},[n._v("65")]),t("br"),t("span",{staticClass:"line-number"},[n._v("66")]),t("br"),t("span",{staticClass:"line-number"},[n._v("67")]),t("br"),t("span",{staticClass:"line-number"},[n._v("68")]),t("br"),t("span",{staticClass:"line-number"},[n._v("69")]),t("br"),t("span",{staticClass:"line-number"},[n._v("70")]),t("br"),t("span",{staticClass:"line-number"},[n._v("71")]),t("br"),t("span",{staticClass:"line-number"},[n._v("72")]),t("br"),t("span",{staticClass:"line-number"},[n._v("73")]),t("br"),t("span",{staticClass:"line-number"},[n._v("74")]),t("br"),t("span",{staticClass:"line-number"},[n._v("75")]),t("br"),t("span",{staticClass:"line-number"},[n._v("76")]),t("br"),t("span",{staticClass:"line-number"},[n._v("77")]),t("br"),t("span",{staticClass:"line-number"},[n._v("78")]),t("br"),t("span",{staticClass:"line-number"},[n._v("79")]),t("br"),t("span",{staticClass:"line-number"},[n._v("80")]),t("br"),t("span",{staticClass:"line-number"},[n._v("81")]),t("br"),t("span",{staticClass:"line-number"},[n._v("82")]),t("br"),t("span",{staticClass:"line-number"},[n._v("83")]),t("br"),t("span",{staticClass:"line-number"},[n._v("84")]),t("br")])]),t("h5",{attrs:{id:"选择器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#选择器"}},[n._v("#")]),n._v(" 选择器")]),n._v(" "),t("p",[n._v("选择器（Selector）是"),t("strong",[n._v("SelectableChannle")]),n._v(" 对象的多路复用器，Selector 可以同时监控多个SelectableChannel 的IO 状况，也就是说，利用Selector 可使一个单独的线程管理多个Channel。"),t("strong",[n._v("Selector 是非阻塞IO 的核心")])]),n._v(" "),t("p",[t("a",{attrs:{href:"https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201112163633.png",target:"_blank",rel:"noopener noreferrer"}},[t("img",{attrs:{src:"https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201112163633.png",alt:"img"}}),t("OutboundLink")],1)]),n._v(" "),t("p",[t("strong",[n._v("选择器的创建")])]),n._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v("// 创建一个选择器\nSelector selector = Selector.open();Copy\n")])]),n._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[n._v("1")]),t("br"),t("span",{staticClass:"line-number"},[n._v("2")]),t("br")])]),t("p",[t("strong",[n._v("绑定选择器")])]),n._v(" "),t("p",[n._v("通过调用通道的register方法可以绑定选择器，register方法有两个参数")]),n._v(" "),t("ul",[t("li",[t("p",[n._v("Selector：即绑定哪个选择器")])]),n._v(" "),t("li",[t("p",[n._v("ops：监听事件类型。ops有4个值可以选择，为"),t("strong",[n._v("SelectionKey")]),n._v("的静态属性")]),n._v(" "),t("p",[t("a",{attrs:{href:"https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201112164022.png",target:"_blank",rel:"noopener noreferrer"}},[t("img",{attrs:{src:"https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201112164022.png",alt:"img"}}),t("OutboundLink")],1)])])]),n._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v("// 让选择器监听一种状态\nmyChannel.register(selector, SelectionKey.OP_READ);\n// 让选择器监听多种状态\nmyChannel.register(selector, SelectionKey.OP_READ | SelectionKey.OP_ACCEPT);Copy\n")])]),n._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[n._v("1")]),t("br"),t("span",{staticClass:"line-number"},[n._v("2")]),t("br"),t("span",{staticClass:"line-number"},[n._v("3")]),t("br"),t("span",{staticClass:"line-number"},[n._v("4")]),t("br")])]),t("p",[t("strong",[n._v("SelectionKey")])]),n._v(" "),t("p",[t("strong",[n._v("表示SelectableChannel 和Selector 之间的注册关系")]),n._v("。每次向选择器注册通道时就会选择一个事件(选择键)。选择键包含两个表示为整数值的操作集。操作集的每一位都表示该键的通道所支持的一类可选择操作")])])}),[],!1,null,null,null);s.default=e.exports}}]);